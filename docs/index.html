<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‚ã„ã‚Šã‚“å ‚ ãƒ¤ãƒ•ã‚ªã‚¯é–‹å‚¬ä¸­ãƒªã‚¹ãƒˆï¼ˆæ–°å•†å“ãƒ»ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰</title>
  <style>
    :root{
      --bg:#ffffff; --panel:#ffffff; --ink:#111827; --muted:#6b7280; --accent:#2563eb; --warn:#f59e0b;
      --border:#e5e7eb; --table:#ffffff; --safe:#18a999;
    }
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans JP,Arial,sans-serif;line-height:1.6}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:16px}
    header .dot{width:12px;height:12px;border-radius:50%;background:var(--accent)}
    header h1{font-size:20px;margin:0}

    /* callout + button */
    .seller-callout{display:grid;gap:8px;justify-items:center;margin:18px 0 22px}
    .seller-callout p{margin:0;font-weight:700}
    .cta-btn{display:inline-flex;align-items:center;gap:8px;background:var(--accent);color:#fff;
      border:0;border-radius:12px;padding:12px 18px;text-decoration:none;font-weight:800;box-shadow:0 6px 18px rgba(37,99,235,.18)}
    .cta-btn:hover{filter:brightness(1.05)}
    .cta-btn svg{width:18px;height:18px}

    .table-wrap{background:var(--table);border:1px solid var(--border);border-radius:16px;overflow:auto}
    table{border-collapse:separate;border-spacing:0;width:100%;min-width:860px}
    thead th{position:sticky;top:0;background:#f9fafb;color:#111827;text-align:left;font-weight:700;font-size:13px;border-bottom:1px solid var(--border);padding:10px 12px}
    tbody td{border-bottom:1px solid var(--border);padding:12px;vertical-align:top}
    tbody tr:hover{background:#f9fafb}

    .thumb{width:140px;height:200px;border:1px dashed #cbd5e1;border-radius:12px;display:grid;place-items:center;overflow:hidden;background:#f3f4f6}
    .thumb img{display:block;height:200px;width:auto;object-fit:contain;cursor:zoom-in}

    .title{font-weight:700}
    .muted{color:var(--muted);font-size:13px}

    .btn-link{display:inline-flex;align-items:center;gap:8px;background:#eef2ff;border:1px solid #c7d2fe;color:#1e3a8a;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:700}
    .btn-link:hover{background:#e0e7ff}

    .footer{color:var(--muted);font-size:13px;margin-top:16px}

    /* overlay viewer */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);display:none;align-items:center;justify-content:center;z-index:60}
    .overlay.open{display:flex}
    .overlay-inner{max-width:min(96vw,1100px);max-height:92vh}
    .overlay-inner img{max-width:100%;max-height:92vh;display:block}
    .overlay-close{position:absolute;top:14px;right:14px;background:#fff;border:0;border-radius:10px;padding:8px 10px;font-weight:800;cursor:pointer}

    /* age gate */
    .age-gate{position:fixed;inset:0;background:rgba(6,7,10,.82);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:80}
    .gate-card{width:min(680px,92vw);background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:24px 20px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .gate-card h2{margin:0 0 8px 0;font-size:22px}
    .gate-card p{color:var(--muted);margin:0 0 18px 0}
    .gate-actions{display:flex;gap:12px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);background:#f8fafc;color:#111827;padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn.primary{background:#22c55e;border-color:transparent;color:#062925;font-weight:700}
    .btn.warn{background:#fff7ed;border-color:#fcd34d;color:#92400e}

    /* small screens: è¡¨ã‚’ã‚«ãƒ¼ãƒ‰å‹ã«ã—ã¦æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ãªãã™ */
    @media (max-width:720px){
      .wrap{padding:16px}
      .table-wrap{border:0}
      table{min-width:0;border-spacing:0}
      thead{display:none}
      tbody tr{display:block;border:1px solid var(--border);border-radius:12px;margin:12px 0;padding:12px}
      tbody td{display:block;border:0;padding:6px 0}
      .thumb{width:100%;height:auto}
      .thumb img{width:100%;height:auto;max-height:60vh}
      .row-title{font-size:16px;font-weight:800;margin:6px 0}
      .row-end{font-size:13px;color:var(--muted);margin:2px 0 8px}
      .row-link{margin-top:10px}
    }
  </style>
</head>
<body>
  <!-- å¹´é½¢ç¢ºèªï¼ˆã‚¢ãƒ—ãƒªå†…ãƒ–ãƒ©ã‚¦ã‚¶æƒ³å®šï¼šé€€å‡ºï¼ãã®å ´ã§é–‰ã˜ã‚‹æŒ™å‹•ï¼‰ -->
  <div class="age-gate" id="ageGate" aria-modal="true" role="dialog">
    <div class="gate-card" role="document">
      <h2>å¹´é½¢ç¢ºèªï½œR-18è¦ç´ ã®ã‚ã‚‹å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚’å«ã¿ã¾ã™</h2>
      <p>18æ­³æœªæº€ã®æ–¹ã¯ã”é€€å‡ºãã ã•ã„ã€‚18æ­³ä»¥ä¸Šã®æ–¹ã®ã¿ã€ä¸‹ã®ã€Œç¶šã‘ã¦è¦‹ã‚‹ã€ã‚’æŠ¼ã—ã¦é€²ã‚“ã§ãã ã•ã„ã€‚</p>
      <div class="gate-actions">
        <button class="btn warn" onclick="closeCurrentOrHide()">é€€å‡ºã™ã‚‹</button>
        <button class="btn primary" onclick="document.getElementById('ageGate').remove()">ç¶šã‘ã¦è¦‹ã‚‹</button>
      </div>
      <p class="muted" style="margin-top:14px">â€» ã“ã®ãƒšãƒ¼ã‚¸ã¯å®‰å…¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã¿ã‚’æ²è¼‰ã—ã€è©³ç´°ã¯å„ãƒ¤ãƒ•ã‚ªã‚¯å‡ºå“ãƒšãƒ¼ã‚¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
    </div>
  </div>

  <div class="wrap">
    <header>
      <div class="dot" aria-hidden="true"></div>
      <h1>ã‚ã„ã‚Šã‚“å ‚ ãƒ¤ãƒ•ã‚ªã‚¯é–‹å‚¬ä¸­ãƒªã‚¹ãƒˆï¼ˆæ–°å•†å“ãƒ»ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰</h1>
    </header>

    <!-- å‡ºå“ãƒªã‚¹ãƒˆ å¼·èª¿è¡¨ç¤º -->
    <div class="seller-callout">
      <p>ğŸ“ <strong>å…¨ã¦ã®å‡ºå“ãƒªã‚¹ãƒˆã¯ã“ã¡ã‚‰ã‹ã‚‰</strong></p>
      <a class="cta-btn" target="_blank" rel="noopener"
         href="https://auctions.yahoo.co.jp/seller/DPouKbofTdHg16XePNS1XBL2MtPry?user_type=c" aria-label="ãƒ¤ãƒ•ã‚ªã‚¯ã®å‡ºå“è€…ãƒšãƒ¼ã‚¸ã‚’é–‹ã">
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M13 5l7 7-7 7M5 12h14"/></svg>
        å‡ºå“ãƒªã‚¹ãƒˆã‚’è¦‹ã‚‹
      </a>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th style="width:160px">å•†å“ç”»åƒ</th>
            <th>å•†å“ã‚¿ã‚¤ãƒˆãƒ«</th>
            <th style="width:180px">çµ‚äº†äºˆå®š</th>
            <th style="width:160px">ãƒªãƒ³ã‚¯</th>
          </tr>
        </thead>
        <tbody id="rows">
          <!-- rows will be injected by JS -->
        </tbody>
      </table>
    </div>

    <div class="footer">
      <p>â–  ãƒ•ã‚©ãƒ­ãƒ¼&ã‚¦ã‚©ãƒƒãƒã®ãŠã™ã™ã‚ï¼šãƒ¤ãƒ•ã‚ªã‚¯ã®å‡ºå“è€…ãƒšãƒ¼ã‚¸ã§ï¼»ãƒ•ã‚©ãƒ­ãƒ¼ï¼½â†’æ–°ç€é€šçŸ¥ã€‚ã‚¦ã‚©ãƒƒãƒç™»éŒ²ã§çµ‚äº†å‰ã«ãƒªãƒã‚¤ãƒ³ãƒ‰é€šçŸ¥ãŒå±Šãã¾ã™ã€‚</p>
    </div>
  </div>

  <!-- overlay viewer -->
  <div class="overlay" id="viewer" aria-modal="true" role="dialog">
    <button class="overlay-close" onclick="hideOverlay()">é–‰ã˜ã‚‹ âœ•</button>
    <div class="overlay-inner"><img id="viewerImg" alt="æ‹¡å¤§è¡¨ç¤º" /></div>
  </div>

<script>
/* ===== å¹´é½¢ã‚²ãƒ¼ãƒˆï¼šã‚¢ãƒ—ãƒªå†…ãƒ–ãƒ©ã‚¦ã‚¶é…æ…®ï¼ˆæˆ»ã‚Œãªã„å ´åˆã¯éè¡¨ç¤ºã§ä»£æ›¿ï¼‰ ===== */
function closeCurrentOrHide(){
  try {
    // Xã‚¢ãƒ—ãƒªç­‰ã§history.back()ãŒåŠ¹ã‹ãªã„å ´åˆã«å‚™ãˆã¦äºŒæ®µæ§‹ãˆ
    if (window.history.length > 1) { history.back(); return; }
  } catch(e){}
  document.getElementById('ageGate')?.remove();
}

/* ===== ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ ===== */
function showOverlay(src){
  const v = document.getElementById('viewer');
  const img = document.getElementById('viewerImg');
  img.src = src;
  v.classList.add('open');
}
function hideOverlay(){
  document.getElementById('viewer').classList.remove('open');
  document.getElementById('viewerImg').src = '';
}

/* ===== ãƒ‡ãƒ¼ã‚¿èª­è¾¼ & ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° =====
   ä½¿ã„æ–¹ï¼š
   - é€šå¸¸ã¯ docs/auctions.json ã‚’èª­ã¿è¾¼ã¿
   - URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ ?src=JSON_URL ã‚’æŒ‡å®šå¯èƒ½
   - ?i=ID|ã‚¿ã‚¤ãƒˆãƒ«|ç”»åƒ|çµ‚äº†æ—¥æ™‚ ã‚’è¤‡æ•°æŒ‡å®šã‚‚å¯
   - ?imgBase=thumbs/ ã®ã‚ˆã†ã«ç”»åƒãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹æŒ‡å®šå¯
*/
(function(){
  const rowsEl = document.getElementById('rows');
  if(!rowsEl) return;

  const params = new URLSearchParams(location.search);
  const debug = params.get('debug') === '1';
  const log = (...a)=>{ if(debug) console.log('[LP]', ...a); };

  const imgBase = params.get('imgBase') || '';
  const utmRaw = params.get('utm');                // ãã®ã¾ã¾æœ«å°¾ã«ä»˜ã‘ã‚‹ç°¡æ˜“UTM
  const utm = utmRaw ? (utmRaw.startsWith('?')? utmRaw : '?' + utmRaw) : '';

  // å®‰å…¨ãªæ–‡å­—åŒ–ã‘è€æ€§ã®è»½é‡ã‚µãƒ‹ã‚¿ã‚¤ã‚º
  const sanitize = (s)=>{
    s = (s ?? '').toString();
    let out = '';
    for (let i=0;i<s.length;i++){
      const c = s.charCodeAt(i);
      if (c >= 32 && c !== 60 && c !== 62 && c !== 34 && c !== 39 && c !== 96) out += s[i];
    }
    return out;
  };

  const joinURL = (base, path)=> {
    if(!path) return '';
    if(/^https?:\/\//i.test(path)) return path;
    if(!base) return path;
    return base.replace(/\/+$/,'') + '/' + path.replace(/^\/+/, '');
  };

  const linkOf = (id)=> `https://auctions.yahoo.co.jp/jp/auction/${sanitize(id)}${utm}`;

  const render = (items)=>{
    if(!Array.isArray(items) || items.length===0){
      rowsEl.innerHTML = '<tr><td colspan="4" class="muted">ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚?i=â€¦ ã¾ãŸã¯ auctions.json ã‚’ã”ç”¨æ„ãã ã•ã„ã€‚</td></tr>';
      return;
    }

    // ä¸¦ã³æ›¿ãˆï¼ˆendãŒå–ã‚Œã‚‹ã‚‚ã®ã¯æ˜‡é †ï¼‰
    items.sort((a,b)=>{
      const da = a.end? new Date(a.end) : null;
      const db = b.end? new Date(b.end) : null;
      if(da && db) return da - db;
      if(da && !db) return -1;
      if(!da && db) return 1;
      return 0;
    });

    // PC:ãƒ†ãƒ¼ãƒ–ãƒ« / ãƒ¢ãƒã‚¤ãƒ«:ã‚«ãƒ¼ãƒ‰
    rowsEl.innerHTML = items.map((it)=>{
      const id = sanitize(it.id);
      const title = sanitize(it.title);
      const note = sanitize(it.note||'');
      const img = joinURL(imgBase || '', sanitize(it.img));
      const end = sanitize(it.end||'');

      const imgTag = img ? `<img src="${img}" alt="${title||'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼'}" onclick="showOverlay('${img}')" />` : '';
      const linkTag = `<a class="btn-link" href="${linkOf(id)}" target="_blank" rel="noopener">ãƒ¤ãƒ•ã‚ªã‚¯ã§è¦‹ã‚‹ â†’</a>`;

      return (
        `<tr class="row">`+
          `<td><div class="thumb">${imgTag}</div></td>`+
          `<td>`+
            `<div class="row-title title">${title||id}</div>`+
            (note? `<div class="muted">${note}</div>` : '')+
            `<div class="row-end">çµ‚äº†äºˆå®šï¼š${end||'-'}</div>`+
            `<div class="row-link">${linkTag}</div>`+
          `</td>`+
          `<td class="hide-sm"><span class="muted">${end}</span></td>`+
          `<td class="hide-sm">${linkTag}</td>`+
        `</tr>`
      );
    }).join('');
  };

  const parseInline = ()=>{
    const items = [];
    const list = params.getAll('i');
    for(const raw of list){
      // id|title|img|end(optional)
      const parts = raw.split('|');
      if(!parts[0]) continue;
      items.push({ id: parts[0], title: parts[1]||'', img: parts[2]||'', end: parts[3]||'' });
    }
    return items;
  };

  const src = params.get('src');
  const defaultSrc = 'auctions.json';

  const tryFetch = (url)=> fetch(url, {cache:'no-cache'}).then(r=>{
    if(!r.ok) throw new Error('HTTP '+r.status);
    return r.json();
  });

  if(src){
    log('fetch src:', src);
    tryFetch(src).then(arr=> render(Array.isArray(arr)?arr:[]) )
      .catch(()=> render(parseInline()));
  }else{
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§åŒéšå±¤ã® auctions.json ã‚’èª­ã‚€
    tryFetch(defaultSrc).then(arr=> render(Array.isArray(arr)?arr:[]) )
      .catch(()=> render(parseInline()));
  }
})();
</script>
</body>
</html>
